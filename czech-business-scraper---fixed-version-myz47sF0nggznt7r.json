{"createdAt":"2025-08-15T13:14:52.078Z","updatedAt":"2025-08-15T13:20:01.000Z","id":"myz47sF0nggznt7r","name":"Czech Business Scraper - Fixed Version","active":false,"isArchived":true,"nodes":[{"parameters":{"assignments":{"assignments":[{"id":"city","name":"city","value":"Praha","type":"string"},{"id":"term","name":"term","value":"kadeřnictví","type":"string"},{"id":"maxResults","name":"maxResults","value":50,"type":"number"}]},"options":{"dotNotation":true}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[200,200],"id":"config","name":"🔧 Configuration"},{"parameters":{"url":"https://www.firmy.cz/?q={{ $json.term }}+{{ $json.city }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"User-Agent","value":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"}]},"options":{"timeout":30000}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[400,200],"id":"scrape","name":"📄 Scrape Search Page","retryOnFail":true,"onError":"continueRegularOutput"},{"parameters":{"jsCode":"const html = $json.data || '';nconst links = [];nconst linkRegex = /<a\\s+class=\"titleLinkOverlay\"[^>]*?href=\"([^\"]*)\"/gi;nlet match;nnwhile ((match = linkRegex.exec(html)) !== null) {n  const url = match[1];n  if (url && url.startsWith('https://www.firmy.cz/detail/')) {n    links.push(url);n  }n}nnreturn {n  json: {n    business_urls: links.slice(0, $('🔧 Configuration').first().json.maxResults),n    count: Math.min(links.length, $('🔧 Configuration').first().json.maxResults)n  }n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[600,200],"id":"extract","name":"🔗 Extract Links"},{"parameters":{"fieldToSplitOut":"business_urls","options":{}},"type":"n8n-nodes-base.itemLists","typeVersion":3,"position":[800,200],"id":"split","name":"📋 Split URLs"},{"parameters":{"batchSize":3,"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[1000,200],"id":"batch","name":"📦 Process in Batches"},{"parameters":{"amount":1,"unit":"seconds"},"type":"n8n-nodes-base.wait","typeVersion":1,"position":[1200,200],"id":"wait","name":"⏱️ Rate Limit"},{"parameters":{"url":"={{ $json }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"User-Agent","value":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"}]},"options":{"timeout":30000}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1400,200],"id":"scrape-business","name":"🏢 Scrape Business","retryOnFail":true,"onError":"continueRegularOutput"},{"parameters":{"jsCode":"const html = $json.data || '';nconst businessUrl = $json;nn// Simple extractionnconst nameMatch = html.match(/<h1[^>]*class=\"[^\"]*detailPrimaryTitle[^\"]*\"[^>]*>([\\s\\S]*?)<\\/h1>/i);nconst emailMatch = html.match(/mailto:([a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,6})/i);nconst phoneMatch = html.match(/<span[^>]*data-dot=\"origin-phone-number\"[^>]*>([\\s\\S]*?)<\\/span>/i);nnreturn {n  json: {n    business_name: nameMatch ? nameMatch[1].replace(/<[^>]*>/g, '').trim() : 'Unknown',n    email: emailMatch ? emailMatch[1] : '',n    phone: phoneMatch ? phoneMatch[1].replace(/<[^>]*>/g, '').trim() : '',n    business_url: businessUrln  }n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1600,200],"id":"extract-data","name":"🧹 Extract Data"},{"parameters":{"aggregate":"aggregateAllItemData","options":{}},"type":"n8n-nodes-base.aggregate","typeVersion":1,"position":[1800,200],"id":"aggregate","name":"📦 Aggregate Data"},{"parameters":{"fieldToSplitOut":"data","options":{}},"type":"n8n-nodes-base.itemLists","typeVersion":3,"position":[2000,200],"id":"split-data","name":"📋 Split Data"},{"parameters":{"operation":"append","documentId":{"__rl":true,"value":"1-r_o5J2st9R4GVzHELLKnGh8N12cM-BAhIBK54GNbcs","mode":"list","cachedResultName":"n8n firmyCZ scrape","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1-r_o5J2st9R4GVzHELLKnGh8N12cM-BAhIBK54GNbcs/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"List 1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1E5lMlVdcH6sEe8yTVKe1cA2qrILtO4Zavad4rU6T-4E/edit#gid=0"},"range":"A:D","columns":{"mappingMode":"defineBelow","value":{"Business Name":"={{ $json.business_name }}","Email":"={{ $json.email }}","Phone":"={{ $json.phone }}","Business URL":"={{ $json.business_url }}"}},"options":{"useAppend":true}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.4,"position":[2200,200],"id":"save","name":"💾 Save to Sheets","credentials":{"googleSheetsOAuth2Api":{"id":"Zx6E2WZ3T6x3R24f","name":"Google Sheets account"}}},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[0,200],"id":"start","name":"🚀 Start"}],"connections":{"🔧 Configuration":{"main":[[{"node":"📄 Scrape Search Page","type":"main","index":0}]]},"📄 Scrape Search Page":{"main":[[{"node":"🔗 Extract Links","type":"main","index":0}]]},"🔗 Extract Links":{"main":[[{"node":"📋 Split URLs","type":"main","index":0}]]},"📋 Split URLs":{"main":[[{"node":"📦 Process in Batches","type":"main","index":0}]]},"📦 Process in Batches":{"main":[[{"node":"⏱️ Rate Limit","type":"main","index":0}]]},"⏱️ Rate Limit":{"main":[[{"node":"🏢 Scrape Business","type":"main","index":0}]]},"🏢 Scrape Business":{"main":[[{"node":"🧹 Extract Data","type":"main","index":0}]]},"🧹 Extract Data":{"main":[[{"node":"📦 Aggregate Data","type":"main","index":0}]]},"📦 Aggregate Data":{"main":[[{"node":"📋 Split Data","type":"main","index":0}]]},"📋 Split Data":{"main":[[{"node":"💾 Save to Sheets","type":"main","index":0}]]},"🚀 Start":{"main":[[{"node":"🔧 Configuration","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","saveDataErrorExecution":"all","saveDataSuccessExecution":"all","saveManualExecutions":true,"saveExecutionProgress":true},"staticData":null,"meta":null,"pinData":null,"versionId":"7657f54c-71bb-4202-bd02-5a25d21b3e08","triggerCount":0,"tags":[]}